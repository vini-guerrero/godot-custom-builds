name: "Environment"
description: "Build Environment"
inputs:
  godot_branch:
    description: "Godot Version"
    required: true
    default: "3.x"
  custom_module:
    description: "Custom Module"
    required: true
    default: ""
runs:
  using: "composite"
  steps:
    - name: Prepare Environment
      run: |
        sudo apt-get update &&
        sudo apt-get install -y --no-install-recommends curl git python python3-pip python-openssl wget zip unzip mingw-w64 &&
        sudo apt-get -y install build-essential pkg-config libx11-dev libxcursor-dev libxinerama-dev libgl1-mesa-dev libglu-dev libasound2-dev libpulse-dev libudev-dev libxi-dev libxrandr-dev yasm &&
        sudo pip3 install scons &&
        sudo python -c "import sys; print(sys.version)" && sudo python --version && sudo scons --version &&
        sudo wget https://github.com/godotengine/godot/archive/refs/heads/${{ inputs.godot_branch }}.zip && 
        sudo unzip ${{ inputs.godot_branch }}.zip && sudo mv godot-${{ inputs.godot_branch }}/* .
        pwd && ls
      shell: bash

    - name: Custom Module
      run: |
        if [ ${{ inputs.custom_module }} != ""]; then
          sudo git clone ${{ inputs.custom_module }} /godot-${{ inputs.godot_branch }}/modules
        fi
      shell: bash

    - name: Compile Engine
      run: |
        sudo scons -j2 verbose=yes warnings=all werror=yes platform=linuxbsd tools=yes tests=no target=release_debug production=yes &&
        sudo scons -j2 verbose=yes warnings=all werror=yes platform=osx tools=yes tests=no target=release_debug production=yes &&
        sudo scons -j2 verbose=yes warnings=all werror=yes platform=windows tools=yes tests=no target=release_debug production=yes
      shell: bash

    - name: Compile Results
      run: ls -l bin/
      shell: bash
